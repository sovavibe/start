<?xml version="1.0"?>
<ruleset name="Custom Test Ruleset"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>
        PMD ruleset for application test files
        Optimized minimal exclusions - test-specific patterns only

        Test-specific exclusions include brief justification.
        Common exclusions (same as main ruleset) use same style.
    </description>

    <!-- Best Practices -->
    <rule ref="category/java/bestpractices.xml">
        <!-- Exclude rules that are too strict or not applicable -->
        <exclude name="GuardLogStatement"/> <!-- Modern SLF4J handles level checks efficiently -->
        <exclude name="UnitTestContainsTooManyAsserts"/> <!-- Tests can have multiple assertions -->
        <exclude name="UnitTestAssertionsShouldIncludeMessage"/> <!-- AssertJ assertions are self-documenting -->
        <exclude name="AbstractClassWithoutAbstractMethod"/> <!-- Test base classes are common -->
        <exclude name="LiteralsFirstInComparisons"/> <!-- Test code prefers "actual equals expected" -->
    </rule>

    <!-- Code Style -->
    <rule ref="category/java/codestyle.xml">
        <!-- Exclude rules that are too strict for modern Java -->
        <exclude name="CommentDefaultAccessModifier"/> <!-- Package-private is acceptable -->
        <exclude name="LongVariable"/> <!-- Descriptive variable names are preferred -->
        <exclude name="AtLeastOneConstructor"/> <!-- Default constructor is acceptable -->
        <exclude name="FieldDeclarationsShouldBeAtStartOfClass"/> <!-- Flexible field ordering -->
        <exclude name="UseExplicitTypes"/> <!-- Java 21+ var inference is preferred -->
        <exclude name="UseUnderscoresInNumericLiterals"/> <!-- Optional style preference -->
        <exclude name="TooManyStaticImports"/> <!-- Test code benefits from static imports -->
        <exclude name="LinguisticNaming"/> <!-- Test method names can be flexible -->
        <exclude name="CallSuperInConstructor"/> <!-- Compiler handles super() automatically -->
        <exclude name="UnnecessaryImport"/> <!-- Test code may have unused imports for future use or IDE autocomplete -->
    </rule>

    <!-- Design -->
    <rule ref="category/java/design.xml">
        <!-- Exclude CyclomaticComplexity to configure it separately below -->
        <exclude name="CyclomaticComplexity"/>
        <!-- Exclude rules that are too strict for framework code -->
        <exclude name="LawOfDemeter"/> <!-- Framework code often uses method chaining -->
        <exclude name="DataClass"/> <!-- Records are data classes by design -->
        <exclude name="TooManyMethods"/> <!-- Tests can have many test methods -->
        <exclude name="SingularField"/> <!-- Test classes can have single-field mocks -->
        <exclude name="AvoidCatchingGenericException"/> <!-- Required for test exception handling -->
        <exclude name="SignatureDeclareThrowsException"/> <!-- Tests using reflection must declare ReflectiveOperationException -->
    </rule>

    <!-- Configure complexity rules with custom thresholds for tests -->
    <!--
    CyclomaticComplexity: Maximum 20 per method (higher than main ruleset)
    Tests can have higher complexity due to setup, assertions, and multiple scenarios.
    Main ruleset uses 10, but tests need more flexibility.
    -->
    <rule ref="category/java/design.xml/CyclomaticComplexity">
        <properties>
            <property name="classReportLevel" value="100"/>
            <property name="methodReportLevel" value="20"/>
        </properties>
    </rule>

    <!-- Error Prone -->
    <rule ref="category/java/errorprone.xml">
        <!-- Exclude MissingSerialVersionUID - not needed for modern Java -->
        <!-- Serialization is handled by frameworks (Jmix, Spring) -->
        <exclude name="MissingSerialVersionUID"/>
        <exclude name="EmptyCatchBlock"/> <!-- Required for test exception patterns -->
        <exclude name="TestClassWithoutTestCases"/> <!-- Allow utility test classes -->
        <exclude name="AvoidAccessibilityAlteration"/> <!-- Tests may access private members -->
        <exclude name="AvoidDuplicateLiterals"/> <!-- Test data can have duplicates -->
    </rule>

    <!-- Performance -->
    <rule ref="category/java/performance.xml">
        <exclude name="AvoidInstantiatingObjectsInLoops"/> <!-- Test data generation requires loops -->
    </rule>

    <!-- Security -->
    <rule ref="category/java/security.xml"/>
    <!-- No exclusions - security rules apply to tests too -->

    <!-- Documentation -->
    <rule ref="category/java/documentation.xml">
        <!-- Exclude CommentRequired - Javadoc is optional for modern Java -->
        <!-- Code should be self-documenting through clear naming and structure -->
        <exclude name="CommentRequired"/>
    </rule>

    <!-- Configure documentation rules with custom limits -->
    <rule ref="category/java/documentation.xml/CommentSize">
        <properties>
            <property name="maxLines" value="50"/>
            <property name="maxLineLength" value="100"/>
        </properties>
    </rule>

</ruleset>
