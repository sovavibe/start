---
globs: ["**/entity/**/*.java", "**/view/**/*.java", "**/service/**/*.java", "**/test/**/*.java", "**/*Test*.java", "build.gradle", "config/spotbugs/**", "config/sonar-project.properties", ".baseline/**"]
alwaysApply: false
autoFix: false
version: "1.1.0"
---

# SUPPRESSION POLICY

## PRINCIPLES
**Vibe Coding**: Minimal suppressions, maximum code quality | **Token Economy**: Optimize suppression usage | **Framework-Specific**: Only suppress Jmix/Vaadin/Lombok false positives | **Central First**: Prefer central config for mass patterns, inline only for unique cases | **AI-Friendly**: See `@ai-false-positives.mdc` for quick decision making

## WHEN TO SUPPRESS

### ✅ Inline `@SuppressWarnings` (Required for PMD, Optional for Others)
**When**: 
- **PMD**: Always required (Baseline limitation - cannot centralize)
- **Other tools**: Only when central config doesn't cover the case

**Requirements**:
- ✅ Always include justification comment
- ✅ Be specific: Use exact rule name (`PMD.RuleName`, `java:S110`, `checkstyle:rulename`)
- ✅ Minimal scope: method > class > package
- ✅ Framework-specific only: Jmix/Vaadin/Lombok patterns, not general code quality
- ✅ Check central configs first (SonarLint, SpotBugs, Checkstyle)

**Examples**: 
- PMD: `PMD.NonSerializableClass` for View classes (cannot centralize)
- Unique cases not covered by central configs

```java
@SuppressWarnings("java:S110") // Framework: Jmix views extend multiple framework classes
public class UserDetailView extends StandardDetailView<User> { }
```

### ✅ Centralized Configs (Mass Framework Patterns) - PREFERRED
**Where**: 
- `config/sonar-project.properties` (SonarLint/SonarQube) - Jmix/Vaadin patterns
- `config/spotbugs/exclude.xml` (SpotBugs) - EclipseLink, framework lifecycle
- `.baseline/checkstyle/custom-suppressions.xml` (Checkstyle) - Lombok, framework patterns

**Requirements**: Narrow scope (package patterns), documented, framework-only

**When to use**: Mass patterns affecting multiple classes (e.g., all View classes, all entity classes)

**IMPORTANT**: Check central configs first before adding inline suppressions!

### ❌ NEVER Global Rule Disabling
**Forbidden**: PMD custom rulesets overriding Baseline, global Checkstyle suppressions, Error Prone disabling without justification

**Why**: Loses Baseline advantages, hides real bugs

## SUPPRESSION HIERARCHY (Most to Least Preferred)
1. **Fix the code** - Best, no suppression needed
2. **Central config (narrow scope)** - Mass framework patterns only (preferred for SonarLint, SpotBugs, Checkstyle)
3. **Inline `@SuppressWarnings`** - Visible, local, documented (required for PMD due to Baseline limitation)
4. **Global rule disabling** - ❌ NEVER (except Baseline-managed)

**IMPORTANT**: Always check central configs first before adding inline suppressions:
- SonarLint: `config/sonar-project.properties`
- SpotBugs: `config/spotbugs/exclude.xml`
- Checkstyle: `.baseline/checkstyle/custom-suppressions.xml`
- PMD: ❌ Cannot centralize (Baseline limitation, must use inline `@SuppressWarnings`)

## FRAMEWORK PATTERNS

| Context | Rules | Centralized? | Format |
|---------|-------|--------------|--------|
| Jmix/Vaadin Views | S110, S2177, S1948 | ✅ Yes (SonarLint) | Central: `config/sonar-project.properties` |
| Jmix/Vaadin Views | PMD.NonSerializableClass | ❌ No (PMD Baseline limitation) | Inline: `@SuppressWarnings("PMD.NonSerializableClass")` |
| Jmix/Vaadin Views | PMD.FieldDeclarationsShouldBeAtStartOfClass | ❌ No (Jmix convention) | Inline: `@SuppressWarnings("PMD.FieldDeclarationsShouldBeAtStartOfClass")` |
| Framework Interfaces | PMD.LongVariable, PMD.FormalParameterNamingConventions | ❌ No (Framework requirements) | Inline: `@SuppressWarnings("PMD.RuleName")` |
| Lombok | AtLeastOneConstructor, javadoc | ✅ Yes (Checkstyle) | Central: `.baseline/checkstyle/custom-suppressions.xml` |
| EclipseLink | ES/EI patterns | ✅ Yes (SpotBugs) | Central: `config/spotbugs/exclude.xml` |
| Tests | Various | ✅ Yes (All tools) | Central: Class patterns in config files |
| Test Reflection | PMD.AvoidAccessibilityAlteration | ✅ Fixed | Use `ReflectionTestUtils.invokeMethod()` instead |

## QUALITY GATES & MAINTENANCE
- CI fails on violations: `ignoreFailures = false`
- Coverage: 85% instruction, 75% branch, 90% line
- Review on Baseline/framework updates, consolidate duplicates
- See `@ai-false-positives.mdc` for quick AI decision making
