---
alwaysApply: true
autoFix: true
version: "8.0.0"
---

# PROJECT RULES
Java 21 | Jmix 2.7.1 | Vaadin 24+ | Spring Boot 3.x | PostgreSQL | Liquibase

## PRINCIPLES
**Code Quality**: Production-ready, Senior+ level, maintainable, testable | **Architecture**: SOLID, Clean Architecture, DRY, KISS | **Approach**: Fix root causes, not symptoms | Refactor, not workarounds | **Standards**: Final fields, immutable, constructor injection, validation

## TECH STACK
Java 21 (virtual threads, pattern matching, records) | Jmix 2.7.1 | Vaadin FlowUI 24+ | Spring Boot 3.x | EclipseLink | Liquibase | Gradle 8.12.x | Quality: Palantir Baseline (Checkstyle, PMD, SpotBugs, Spotless, Error-prone), SonarLint | Frontend: stylelint, prettier

## GRADLE VERSION CONSTRAINT
**Gradle 8.12.x (max 8.x)**: Jmix 2.7.1 is incompatible with Gradle 9+ | Gradle 9 removed `groovy.util.XmlParser` used by Jmix plugin | ❌ Do not upgrade to Gradle 9.x until Jmix is updated | ✅ Use Gradle 8.12.x or lower | Check compatibility when updating Jmix

## METRICS & QUALITY
**Limits**: 250 lines/file, 10 cyclomatic, 10 cognitive complexity | **Refactor** if exceeded: extract methods, split files | Use `@code-quality.mdc`

## WORKFLOW
Linters run at end only | Use `make analyze-full` (not `./gradlew codeQualityFull`) | Format: `./gradlew format` (Palantir Baseline) | Fix root causes, not symptoms | Production-ready, maintainable, testable | Use `@ai-rules.mdc` for AI workflow

## PALANTIR BASELINE
**Main plugin**: `com.palantir.baseline` (6.76.0) - includes Checkstyle, PMD, SpotBugs, Spotless auto-configuration | **Additional**: `baseline-idea`, `baseline-exact-dependencies`, `baseline-error-prone`, `baseline-class-uniqueness`, `baseline-prefer-project-modules` | **Format**: `./gradlew format` auto-formats Java files | **Checkstyle**: Suppress via `@SuppressWarnings("checkstyle:rulename")` or `// CHECKSTYLE:OFF/ON` | **Custom suppressions**: `.baseline/checkstyle/custom-suppressions.xml` (NOT `checkstyle-suppressions.xml`) | **Copyright**: Apache License 2.0, holder: Digital Technologies and Platforms LLC | Templates: `.baseline/copyright/*.txt`, `./gradlew format` auto-updates headers | Use `@palantir-baseline-integration.mdc` for detailed integration | Use `@suppress-policy.mdc` for suppression guidelines | **Reference**: [Palantir Baseline](https://github.com/palantir/gradle-baseline)

## DATABASE (CRITICAL)
**DataManager**: `create()`, `save()`, `load().id().one()`, `load().condition()`, `remove()` | ❌ `new Entity()` → ✅ `dataManager.create()` | **EntityManager**: Only native SQL (health checks) | JPQL over native | Liquibase: V{version}__{desc}.xml, never modify applied | @Version for optimistic locking | Use `@jmix-best-practices.mdc`

## JMIX
`dataManager.create()` not `new Entity()` | @JmixEntity + @JmixGeneratedValue + @Version | StandardListView<T>/StandardDetailView<T> | @Transactional in services only | Constructor injection | Use `@jmix-best-practices.mdc`

## VAADIN
@Route: Constructor → beforeEnter → afterNavigation → onDetach | @UIScope: Constructor → onAttach → onDetach | @ViewComponent for UI | ❌ @Component + Dialog | Use `@vaadin-best-practices.mdc`

## SECURITY
@Secret passwords | PasswordEncoder.encode() | Parameterized queries (JPQL) | @Value("${key}") not System.getenv() | ❌ Secrets in code | Jmix: @ResourceRole, @RowLevelRole, @EntityPolicy

## LOGGING & TESTING
**Logging**: Structured `log.info("key={}", value)` | DEBUG/INFO/WARN/ERROR | ❌ Concat, passwords/tokens | **Testing**: ❌ Delete failing tests → fix root | @ExtendWith({SpringExtension.class, AuthenticatedAsAdmin.class}) | @Autowired allowed in tests | Use `@testing-policy.mdc`

## COMMITS & COMM
Conventional: `type(scope): description` | Types: feat|fix|docs|refactor|perf|test|build|chore | Scopes: jmix|vaadin|entity|view|service|security|liquibase|ui|api|db|config|test | Use `@conventional-commits.mdc` | **Communication**: English code/docs, Russian chat, brevity

## PROHIBITIONS
System.out.println → SLF4J | System.getenv() → @Value | @Autowired fields → constructor (tests: allowed) | Dead code → remove | Workarounds → refactor | @SuppressWarnings → document why

## SUPPRESSION PRINCIPLES
**Vibe Coding**: Minimal suppressions, maximum code quality | **Token Economy**: Optimize rule usage | **Framework-Specific**: Suppressions only for Jmix/Vaadin/Lombok false positives | **Local First**: Prefer inline `@SuppressWarnings` over global configs | Use `@suppress-policy.mdc` for detailed guidelines
