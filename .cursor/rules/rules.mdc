---
alwaysApply: true
autoFix: true
version: "8.0.0"
---

# PROJECT RULES
Java 21 | Jmix 2.7.1 | Vaadin 24+ | Spring Boot 3.x | PostgreSQL | Liquibase

## TECH STACK
Java 21 (virtual threads, pattern matching, records) | Jmix 2.7.1 | Vaadin FlowUI 24+ | Spring Boot 3.x | EclipseLink | Liquibase | Gradle | Quality: Spotless, Checkstyle, PMD, SpotBugs, SonarLint | Frontend: stylelint, prettier

## METRICS & QUALITY
**Limits**: 250 lines/file, 10 cyclomatic, 10 cognitive complexity | **Standards**: SOLID, Clean Architecture, DRY, KISS | **Refactor** if exceeded: extract methods, split files | See code-quality.mdc

## WORKFLOW
Linters run at end only | Use `make analyze-full` (not `./gradlew codeQualityFull`) | Fix root causes, not symptoms | Production-ready, maintainable, testable | See ai-rules.mdc for AI workflow

## DATABASE (CRITICAL)
**DataManager**: `create()`, `save()`, `load().id().one()`, `load().condition()`, `remove()` | ❌ `new Entity()` → ✅ `dataManager.create()` | **EntityManager**: Only native SQL (health checks) | JPQL over native | Liquibase: V{version}__{desc}.xml, never modify applied | @Version for optimistic locking | See jmix-best-practices.mdc

## JMIX
`dataManager.create()` not `new Entity()` | @JmixEntity + @JmixGeneratedValue + @Version | StandardListView<T>/StandardDetailView<T> | @Transactional in services only | Constructor injection | See jmix-best-practices.mdc

## VAADIN
@Route: Constructor → beforeEnter → afterNavigation → onDetach | @UIScope: Constructor → onAttach → onDetach | @ViewComponent for UI | ❌ @Component + Dialog | See vaadin-best-practices.mdc

## SECURITY
@Secret passwords | PasswordEncoder.encode() | Parameterized queries (JPQL) | @Value("${key}") not System.getenv() | ❌ Secrets in code | Jmix: @ResourceRole, @RowLevelRole, @EntityPolicy

## LOGGING & TESTING
**Logging**: Structured `log.info("key={}", value)` | DEBUG/INFO/WARN/ERROR | ❌ Concat, passwords/tokens | **Testing**: ❌ Delete failing tests → fix root | @ExtendWith({SpringExtension.class, AuthenticatedAsAdmin.class}) | @Autowired allowed in tests | See testing-policy.mdc

## COMMITS & COMM
Conventional: `type(scope): description` | Types: feat|fix|docs|refactor|perf|test|build|chore | Scopes: jmix|vaadin|entity|view|service|security|liquibase|ui|api|db|config|test | See conventional-commits.mdc | **Communication**: English code/docs, Russian chat, brevity

## PROHIBITIONS
System.out.println → SLF4J | System.getenv() → @Value | @Autowired fields → constructor (tests: allowed) | Dead code → remove | Workarounds → refactor | @SuppressWarnings → document why
