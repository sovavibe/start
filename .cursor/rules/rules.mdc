---
alwaysApply: true
autoFix: true
version: "8.0.0"
---

# PROJECT RULES
Java 21 | Jmix 2.7.1 | Vaadin 24+ | Spring Boot 3.x | PostgreSQL | Liquibase

## PRINCIPLES
**Code Quality**: Production-ready, Senior+ level, maintainable, testable | **Architecture**: SOLID, Clean Architecture, DRY, KISS | **Approach**: Fix root causes, not symptoms | Refactor, not workarounds | **Standards**: Final fields, immutable, constructor injection, validation

## TECH STACK
Java 21 (virtual threads, pattern matching, records) | Jmix 2.7.1 | Vaadin FlowUI 24+ | Spring Boot 3.x | EclipseLink | Liquibase | Gradle 8.12.x | Quality: Palantir Baseline (Checkstyle, PMD, SpotBugs, Spotless, Error-prone), SonarLint | Frontend: stylelint, prettier

## GRADLE VERSION CONSTRAINT
**Gradle 8.12.x (max 8.x)**: Jmix 2.7.1 is incompatible with Gradle 9+ | Gradle 9 removed `groovy.util.XmlParser` used by Jmix plugin | ❌ Do not upgrade to Gradle 9.x until Jmix is updated | ✅ Use Gradle 8.12.x or lower | Check compatibility when updating Jmix

## METRICS & QUALITY
**Limits**: 250 lines/file, 10 cyclomatic, 10 cognitive complexity | **Refactor** if exceeded: extract methods, split files | See `@code-quality.mdc` for details

## WORKFLOW
Linters run at end only | Use `make analyze-full` (not `./gradlew codeQualityFull`) | Fix root causes, not symptoms | Production-ready, maintainable, testable | See `@ai-rules.mdc` for AI workflow | See `@palantir-baseline-integration.mdc` → FORMATTING

## PALANTIR BASELINE
See `@palantir-baseline-integration.mdc` | Suppressions: `@suppress-policy.mdc`

## DATABASE
See `@jmix-data-access.mdc`

## JMIX
See `@jmix-best-practices.mdc`

## VAADIN
See `@vaadin-best-practices.mdc` | Quick: @Route lifecycle, @UIScope patterns

## SECURITY
@Secret passwords | PasswordEncoder.encode() | Parameterized queries | See `@jmix-security.mdc`

## LOGGING & TESTING
**Logging**: Structured `log.info("key={}", value)` | DEBUG/INFO/WARN/ERROR | ❌ Concat, passwords/tokens | **Testing**: See `@testing-policy.mdc`

## COMMITS & COMM
Conventional: `type(scope): description` | Types: feat|fix|docs|refactor|perf|test|build|chore | Scopes: jmix|vaadin|entity|view|service|security|liquibase|ui|api|db|config|test | See `@conventional-commits.mdc` for details

## COMMUNICATION LANGUAGE
**CRITICAL - MANDATORY**: Language usage is strict and context-dependent. **MUST BE ENFORCED BY ALL AGENTS**:
- **Code & Documentation**: **MANDATORY - ALWAYS English** (comments, JavaDoc, README, code, commit messages, rules documentation, strings, error messages, log messages)
- **Chat with User**: ✅ Use Russian when user communicates in Russian | ✅ Use English when user communicates in English | Adapt to user's language preference
- **Brevity**: Be concise, avoid verbose explanations unless requested
- **ENFORCEMENT**: 
  - ❌ **NEVER** write code comments in any non-English language
  - ❌ **NEVER** write JavaDoc in any non-English language
  - ❌ **NEVER** write commit messages in any non-English language
  - ❌ **NEVER** write code strings in any non-English language (except localization files)
  - ❌ **NEVER** write error messages in any non-English language
  - ✅ **ALWAYS** use English for all code, comments, documentation, commit messages
- **Examples**: 
  - ✅ Chat in Russian: "Файлы успешно добавлены в git" (use language of user's request)
  - ✅ Chat in English: "Files successfully added to git" (use language of user's request)
  - ✅ Code comment: `// Loads user from database` (always English)
  - ✅ Rule documentation: "Use DataManager.create() instead of new Entity()" (always English)
  - ❌ Code comment in non-English: `// Загружает пользователя из базы данных` **FORBIDDEN**
  - ❌ Commit message in non-English: `feat: добавить проверку` **FORBIDDEN**
  - ❌ Code string in non-English: `String message = "Ошибка";` **FORBIDDEN**

## PROHIBITIONS
System.out.println → SLF4J | System.getenv() → @Value | @Autowired fields → constructor (tests: allowed) | Dead code → remove | Workarounds → refactor | @SuppressWarnings → document why

## SUPPRESSION PRINCIPLES
See `@suppress-policy.mdc` for comprehensive guidelines | **Vibe Coding**: Minimal suppressions, maximum code quality | **Token Economy**: Optimize rule usage
