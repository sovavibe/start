---
globs: ["**/entity/**/*.java", "**/service/**/*.java", "**/view/**/*.java", "**/security/**/*.java", "**/config/**/*.java", "application*.yml", "application*.properties"]
autoFix: true
version: "5.2.0"
---

# CODE QUALITY

## JAVA 21
Virtual threads, pattern matching, records (5+ params → Builder), text blocks

## METRICS
**Limits**: 250 lines/file, 10 cyclomatic, 10 cognitive complexity | **If exceeded**: Refactor (extract methods, split files) | **Formatting**: 120 chars/line (Palantir Style Guide standard), Palantir Java Format (Spotless via Baseline) | **Suppressions**: Document why, fix root cause

**Reference**: [Palantir Java Style Guide](https://github.com/palantir/gradle-baseline/blob/develop/docs/java-style-guide/readme.md)

## CHECKSTYLE SUPPRESSIONS
- **Per-line/block**: `@SuppressWarnings("checkstyle:rulename")` (lowercase, without "Check" suffix)
- **Comments**: `// CHECKSTYLE:OFF` ... `// CHECKSTYLE:ON` (for IllegalImport)
- **File-level**: `.baseline/checkstyle/custom-suppressions.xml` (NOT `checkstyle-suppressions.xml` - auto-generated)
- **Best practice**: Format code first, then suppress only if necessary
- See `@suppress-policy.mdc` for comprehensive guidelines

## FQN (FULLY QUALIFIED NAMES) CHECK
- **Rule**: `AvoidFullyQualifiedNames` (Checkstyle RegexpSinglelineJava)
- **Location**: `.baseline/checkstyle/checkstyle.xml` (TreeWalker section)
- **Pattern**: Universal - catches any FQN pattern `package.subpackage.Class` (minimum 2 dots)
- **Example violations**: 
  - `io.jmix.flowui.view.View<?> loginView` → should use `View<?> loginView` with import
  - `java.lang.reflect.Method method` → should use `Method method` with import
- **Exclusions**: Imports and package declarations automatically excluded
- **Suppression**: `@SuppressWarnings("checkstyle:avoidfullyqualifiednames")` if truly necessary (rare)

## FORMATTING
- **Command**: `./gradlew format` (Palantir Baseline format task)
- **Auto-configuration**: Baseline configures Spotless with `importOrder`, `removeUnusedImports`, `trimTrailingWhitespace`, `endWithNewline`, `palantirJavaFormat` (2.68.0)
- See `@palantir-baseline-integration.mdc` for detailed Baseline configuration

## STANDARDS
SOLID, Clean Architecture, DRY, KISS | Final fields, immutable | Constructor injection | @Nullable/@NonNull | Validation: @Email, @NotNull, @Size | Senior+ level: production-ready, maintainable, testable

## SPRING & ENV
@Configuration, @Bean | @Transactional (service, readOnly) | ❌ System.getenv() → ✅ @Value("${app.key:default}") | Profiles: application-{profile}.yml | ❌ Secrets in code → env vars

## LOGGING & SECURITY
Structured: `log.info("key={}", value)` | DEBUG/INFO/WARN/ERROR | ❌ Concat, passwords/tokens | @Secret passwords | Parameterized queries (JPQL) | Input validation
