---
globs: ["**/view/**/*.java", "**/view/**/*.xml"]
autoFix: true
version: "1.1.0"
---

# JMIX VIEWS

## VIEW ARCHITECTURE
StandardView (general) | StandardListView<T> (lists) | StandardDetailView<T> (detail/edit) | Constructor: services | @ViewComponent: UI components | ❌ @Autowired fields

## VIEW ANNOTATIONS
**@ViewController**: Marks view class | **@ViewDescriptor**: XML layout path | **@LookupComponent**: Component for lookup dialogs | **@EditedEntityContainer**: Data container for detail views | **@DialogMode**: Dialog size | **@ViewComponent**: Inject UI components | **@Install**: Customize component behavior (renderers, validators)

## VIEW SERVICES
**Messages**: `messages.getMessage("key")` for i18n | **MessageBundle**: View-specific messages | **UiComponents**: Factory for components | **ViewNavigators**: Programmatic navigation | **Notifications**: User notifications | **EntityStates**: Check entity state (isNew, isDetached)

## DECLARATIVE UI (XML)

### Data Containers
**InstanceContainer**: Single entity | **CollectionContainer**: Collection of entities | Defined in `<data>` section

**Binding**: `dataContainer="containerId"` - bind container to component | `property="fieldName"` - bind field to component | `dataLoader="loaderId"` - bind loader to component

### Data Loaders
**InstanceLoader**: Single entity | **CollectionLoader**: Collection | Defined inside `<instance>` or `<collection>` | **Attributes**: `id` (required for collection), `readOnly="true"`, `dataContext="contextId"`

**Programmatic**: `@ViewComponent CollectionLoader<Order> ordersDl;` | `ordersDl.load()` | `ordersDl.setParameter("status", OrderStatus.PENDING); ordersDl.load()`

### Actions
**Types**: `list_create`, `list_edit`, `list_remove`, `detail_saveClose`, `detail_close`, `lookup_select`, `lookup_discard` | **Binding**: `action="actionId"` | **Custom**: `@Subscribe("customButton")`

### Facets
**dataLoadCoordinator**: Auto-loading (`auto="true"`) | **urlQueryParameters**: URL sync (filter, pagination)

### FetchPlan
**System FetchPlans**: `_base` (default), `_instance_name` (includes @InstanceName), `_local` (direct attributes only) | Use `extends` to reference

## DATACONTEXT
**StandardDetailView**: Auto-creates/manages DataContext | Tracks entity changes | Save operation saves all "dirty" entities

**Methods**: `save()` - saves all dirty | `clear()` - clears all | `hasChanges()` - check changes | `get(entity)` - get from context | `remove(entity)` - mark for deletion

**Hierarchy (Aggregates)**: Parent-Child contexts for @Composition | Child saves to parent, parent saves to DB

**Best Practices**: ✅ StandardDetailView manages automatically | ✅ Use hierarchy for aggregates | ✅ Check `hasChanges()` before closing | ⚠️ View-scoped (not shared)

## EDITING AGGREGATES
**@Composition**: Marks composition relationship | Cascade delete | Saved together in one transaction

**Flow**: Parent View creates parent DataContext, loads aggregate with FetchPlan | Child View creates child DataContext, sets parent | Save in child → parent context | Save in parent → DB in one transaction

**Best Practices**: ✅ Always load aggregates with FetchPlan | ✅ Use StandardDetailView | ✅ Save only in root entity view | ⚠️ Don't save child entities separately

## VIEW LIFECYCLE EVENTS
**View Events**: **InitEvent** - View initialization | **BeforeShowEvent** - Before shown (UI ready, URL params) | **AfterShowEvent** - After shown | **ReadyEvent** - All components initialized

**Component Events**: **@Subscribe("componentId")** - Subscribe by ID | **Button Click**: `@Subscribe("saveButton")` | **Field Change**: `@Subscribe("nameField")` | **Grid Selection**: `@Subscribe("usersDataGrid")` | **Multiple**: `@Subscribe({"button1", "button2"})`

**Best Practices**: ✅ Use InitEvent for data loading | ✅ Use BeforeShowEvent for URL params | ✅ Keep handlers focused | ⚠️ Avoid heavy operations (use async)

## LOOKUP DIALOGS
**Setup**: **@LookupComponent** - Mark component | **Lookup Actions**: `lookup_select`, `lookup_discard` in XML | **Mode**: Auto-switches when opened as dialog

**Opening**: **ViewNavigators** - Programmatic | **LookupScreenFacet** - Builder

**API**: `getSingleSelectedItem()` - Single selection | `getSelectedItems()` - Multi-selection

**Best Practices**: ✅ Handle selection in `AfterCloseEvent` | ✅ Use `StandardOutcome.SELECT` to check selection | ⚠️ Lookup mode is automatic
